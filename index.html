<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>System Update</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --bg-color: #fff5f7;
            --mom-bubble: #ffffff;
            --my-bubble: #ff6b9d;
            --accent: #d81b60;
        }

        body, html {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            background-color: var(--bg-color);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            overflow: hidden;
        }

        /* Login Screen */
        #login-screen {
            position: fixed;
            inset: 0;
            background: white;
            z-index: 5000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 20px;
        }

        .login-btn {
            width: 200px;
            padding: 15px;
            border: 2px solid var(--my-bubble);
            background: white;
            color: var(--my-bubble);
            border-radius: 30px;
            font-weight: bold;
            font-size: 18px;
        }

        /* App Layout */
        #app-container {
            display: none; /* Hidden until login */
            flex-direction: column;
            height: 100%; width: 100%;
            transition: filter 0.8s ease;
        }

        #header {
            background: white;
            padding: 15px;
            text-align: center;
            font-weight: 600;
            border-bottom: 1px solid #ffe1e9;
            color: var(--accent);
        }

        #chat-window {
            flex-grow: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding-bottom: 150px;
        }

        .bubble {
            max-width: 75%;
            padding: 12px 16px;
            border-radius: 20px;
            font-size: 16px;
            line-height: 1.4;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .my { align-self: flex-start; background: var(--my-bubble); color: white; border-bottom-left-radius: 4px; }
        .mom { align-self: flex-end; background: #f0f0f0; color: #333; border-bottom-right-radius: 4px; }

        #typing-box {
            display: none;
            align-self: flex-start;
            background: #eee;
            padding: 10px 15px;
            border-radius: 20px;
            margin-left: 15px;
            margin-bottom: 10px;
        }

        .dot { display: inline-block; width: 6px; height: 6px; background: #bbb; border-radius: 50%; margin-right: 3px; animation: blink 1.4s infinite both; }
        .dot:nth-child(2) { animation-delay: 0.2s; }
        .dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes blink { 0% { opacity: .2; } 20% { opacity: 1; } 100% { opacity: .2; } }

        #options-container {
            position: fixed;
            bottom: 0; width: 100%;
            background: white;
            padding: 20px;
            display: none;
            flex-direction: column;
            gap: 12px;
            border-radius: 25px 25px 0 0;
            box-shadow: 0 -10px 25px rgba(0,0,0,0.1);
            z-index: 10;
        }

        .option-btn { background: var(--my-bubble); color: white; border: none; padding: 15px; border-radius: 30px; font-weight: 600; font-size: 15px; }

        .blurred { filter: blur(15px); pointer-events: none; }

        #overlay {
            position: fixed;
            inset: 0;
            background: rgba(255, 192, 203, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        #valentine-card {
            background: white;
            padding: 40px 20px;
            border-radius: 40px;
            width: 85%;
            text-align: center;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }

        #final-text {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 50px;
            font-weight: 900;
            color: var(--accent);
            display: none;
            text-align: center;
            text-shadow: 3px 3px 0px white;
            z-index: 9999;
            width: 100%;
        }
    </style>
</head>
<body>

<div id="login-screen">
    <h2 style="color: var(--accent)">Who is opening this?</h2>
    <button class="login-btn" onclick="login('mama')">Mama ‚ù§Ô∏è</button>
    <button class="login-btn" onclick="login('lastborn')">Last Born üòé</button>
</div>

<div id="app-container">
    <div id="header" id="user-header">Lastborn ‚ù§Ô∏è</div>
    <div id="chat-window"></div>
    <div id="typing-box">
        <span class="dot"></span><span class="dot"></span><span class="dot"></span>
    </div>
    <div id="options-container"></div>
</div>

<div id="overlay">
    <div id="valentine-card">
        <h1 style="color: #c2185b; font-size: 28px; margin-bottom: 30px;">WILL YOU BE MY VALENTINE? üåπ</h1>
        <div style="display: flex; flex-direction: column; gap: 15px;">
            <button class="option-btn" onclick="finish('Oh my god! Yes!')">Oh my god! Yes!</button>
            <button class="option-btn" onclick="finish('Yes! Yes! Yes! Yes! Yeesss!!')">Yes! Yes! Yes! Yes! Yeesss!!</button>
        </div>
    </div>
</div>

<div id="final-text">IT'S A DATE!!! ‚ù§Ô∏è</div>

<script>
    const chat = document.getElementById('chat-window');
    const typing = document.getElementById('typing-box');
    const options = document.getElementById('options-container');
    let currentUser = '';

    const script = [
        { type: 'text', content: "Hey mama." },
        { type: 'text', content: "I don't know how you're gonna find this news but I want to go on a date with someone I love.üëÄ" },
        { type: 'text', content: "I need your help with planning the whole thing out." },
        { type: 'text', content: "This is my first loveüò≠.." },
        { type: 'choice', choices: ["What! I mean.. I didn't expect this but I guess I'll help?", "Sure! Happy to help"] },
        { type: 'text', content: "Well.. I'm sorry to dissapoint you but it's a she.ü§¶‚Äç‚ôÄÔ∏è" },
        { type: 'text', content: "Thought you should knowüëÄ..." },
        { type: 'choice', choices: ["What!!!! Ohh nooooü§¶‚Äç‚ôÄÔ∏è", "Okay?"] },
        { type: 'text', content: "üëÄAnyways, do you think it will be better to eat sushi or pasta or steak or a chicken meal?" },
        { type: 'choice', choices: ["Sushi üç£", "Pasta üçù", "Steak ü•©", "Chicken üçó"] },
        { type: 'text', content: "What's the best gift to get her? Necklace, bracelet or watch?" },
        { type: 'text', content: "I want it to be something of sentimental value so she can always remember this day with." },
        { type: 'text', content: "I mean she's my first loveüòä... " },
        { type: 'choice', choices: ["Necklace üíé", "Bracelet ‚ú®", "Watch ‚åö"] },
        { type: 'text', content: "Ok, I think I have an idea of what to get now." },
        { type: 'text', content: "Hopefully she loves all of thisüòå." },
        { type: 'text', content: "Oh! One last question‚òù. So mama.." },
        { type: 'valentine' }
    ];

    let step = 0;

    function login(user) {
        currentUser = user;
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('app-container').style.display = 'flex';
        
        if (user === 'lastborn') {
            document.getElementById('header').innerText = "Viewer Mode (Mom's Answers)";
            loadMomAnswers();
        } else {
            setTimeout(runScript, 1000);
        }
    }

    async function runScript() {
        if (step >= script.length) return;
        const current = script[step];

        if (current.type === 'text') {
            typing.style.display = 'block';
            chat.appendChild(typing); // Move typing dots to the bottom
            chat.scrollTop = chat.scrollHeight;
            
            const typingTime = 2000 + (current.content.length * 25); 
            await new Promise(r => setTimeout(r, typingTime));
            
            typing.style.display = 'none';
            addBubble(current.content, 'my');
            
            const readingTime = 2200 + (current.content.length * 30);
            step++;
            setTimeout(runScript, readingTime);

        } else if (current.type === 'choice') {
            await new Promise(r => setTimeout(r, 2000));
            showChoices(current.choices);
        } else if (current.type === 'valentine') {
            typing.style.display = 'block';
            chat.appendChild(typing);
            chat.scrollTop = chat.scrollHeight;
            await new Promise(r => setTimeout(r, 3500));
            showValentine();
        }
    }

    function addBubble(text, sender) {
        const div = document.createElement('div');
        div.className = `bubble ${sender}`;
        div.innerText = text;
        chat.appendChild(div);
        chat.scrollTop = chat.scrollHeight;
    }

    function showChoices(choicesArr) {
        options.innerHTML = '';
        choicesArr.forEach(choice => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = choice;
            btn.onclick = async () => {
                options.style.display = 'none';
                addBubble(choice, 'mom');
                
                // Save answer for "Last Born" to see later
                let answers = JSON.parse(localStorage.getItem('mom_responses') || "[]");
                answers.push(choice);
                localStorage.setItem('mom_responses', JSON.stringify(answers));

                step++;
                await new Promise(r => setTimeout(r, 4000));
                runScript();
            };
            options.appendChild(btn);
        });
        options.style.display = 'flex';
        chat.scrollTop = chat.scrollHeight;
    }

    function loadMomAnswers() {
        const saved = JSON.parse(localStorage.getItem('mom_responses') || "[]");
        if(saved.length === 0) {
            addBubble("No answers yet! Mama hasn't finished the game.", "my");
        } else {
            saved.forEach(ans => addBubble("She chose: " + ans, "mom"));
        }
    }

    function showValentine() {
        typing.style.display = 'none';
        document.getElementById('app-container').classList.add('blurred');
        document.getElementById('overlay').style.display = 'flex';
    }

    function finish(choice) {
        document.getElementById('overlay').style.display = 'none';
        const final = document.getElementById('final-text');
        final.style.display = 'block';
        
        // Fixed Audio Link
        const audio = new Audio('https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3');
        audio.play().catch(e => console.log("Audio needs interaction"));

        confetti({
            particleCount: 250,
            spread: 100,
            origin: { y: 0.6 },
            colors: ['#ff6b9d', '#ffffff', '#ff0000']
        });
    }
</script>

</body>
</html>
